<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.doit.ik.mapper.NoticeMapper">
  
	<!-- public int getCount(String field, String query) throws ClassNotFoundException, SQLException;-->	
	<select id="getCount" resultType="int">
		SELECT COUNT(*) CNT 
		FROM NOTICES 
		WHERE ${field} LIKE '%${query}%'
	</select>
	<!-- public List<NoticeVO> getNotices(int page, String field, String query  ) throws ClassNotFoundException, SQLException; -->
	<select id="getNotices" resultType="org.doit.ik.domain.NoticeVO">
		SELECT *
		FROM ( SELECT ROWNUM NUM, N.*
			FROM ( SELECT *	FROM NOTICES
					WHERE ${field} LIKE '%${query}%'
					ORDER BY REGDATE DESC
					) N
				)	WHERE NUM BETWEEN (1+(#{page}-1)*15) AND (15+(#{page}-1)*15)   
	</select>
	
	<!-- public int delete(String seq) throws ClassNotFoundException, SQLException; -->
	<delete id="delete">
		DELETE NOTICES 
		WHERE SEQ = #{seq}
	</delete>
	
	<!-- public int update(NoticeVO noticeVO) throws ClassNotFoundException, SQLException; -->
	<update id="update">
		UPDATE NOTICES 
		SET TITLE = #{title}, CONTENT = #{content}
		<if test="filesrc != null">
		, FILESRC = #{filesrc} 
		</if>
		WHERE SEQ = #{seq} 
	</update>
	
	<!-- public NoticeVO getNotice(String seq) throws ClassNotFoundException, SQLException; -->
	<select id="getNotice" resultType="org.doit.ik.domain.NoticeVO">
		SELECT * 
		FROM NOTICES
		WHERE SEQ = #{seq} 
	</select>
	
	<!-- public int insert(NoticeVO noticeVO) throws ClassNotFoundException, SQLException ; -->
	
	<insert id="insert">
	    <selectKey order="BEFORE" resultType="String" keyProperty="seq">
	      SELECT NVL(MAX(TO_NUMBER(SEQ))+1,1) 
	      FROM NOTICES
	    </selectKey>
	    INSERT INTO NOTICES  
	   ( SEQ, TITLE, CONTENT, WRITER, REGDATE, HIT, FILESRC )  
	   VALUES 
	   ( #{ seq } , #{ title } , #{ content }, #{ writer }, SYSDATE, 0,
	      #{filesrc, javaType=String, jdbcType=VARCHAR}  )
	 </insert>
	 
	<!-- public int updateMemberPoint(@Param("id") String id)throws ClassNotFoundException, SQLException ; -->
	<update id="updateMemberPoint">
	UPDATE MEMBER 
	SET point = point + 1
	 WHERE ID = #{id}
	</update>
	
	
	<!-- public void hitUp(String seq) throws ClassNotFoundException, SQLException; -->
	<update id="hitUp">
		UPDATE notices 
		SET hit = hit + 1 
		WHERE seq = #{seq}
	</update>
  	<!-- public int getHit(@Param("seq")String seq) throws ClassNotFoundException, SQLException; -->
  	<select id="getHit" resultType="int">
  		SELECT hit 
		FROM notices 
		WHERE seq = #{seq}
  	</select>
</mapper>  








